var g_resolution=50;var g_asymptote_limit=100;registerKeyboardHandler=function(a){var a=a;d3.select(window).on("keydown",a)};function f_of_x(f,x){return eval(f)}function nth_root(a,f){try{var d=f%2==1&&a<0;if(d){a=-a}var b=Math.pow(a,1/f);f=Math.pow(b,f);if(Math.abs(a-f)<1&&(a>0==f>0)){return d?-b:b}}catch(c){}}function isNumeric(a){return !isNaN(parseFloat(a))&&isFinite(a)}function convert_fractional_power(a){a=a.replace(/Math\.pow\(x\,1\/([3579][13579]*)\)/g,"nth_root(x,$1)");return a}SimpleGraph=function(c,b){var a=this;this.chart=document.getElementById(c);this.cx=this.chart.clientWidth;this.cy=this.chart.clientHeight;this.options=b||{};this.options.xmin=b.xmin||-10;this.options.xmax=b.xmax||10;this.options.ymin=b.ymin||-10;this.options.ymax=b.ymax||10;this.points=[];this.lines=[];this.num_funcs=this.options.funcs.length;for(var d=0;d<this.num_funcs;d++){this.options.funcs[d]=convert_fractional_power(this.options.funcs[d])}this.padding={top:20,right:5,bottom:40,left:40};this.size={width:this.cx-this.padding.left-this.padding.right,height:this.cy-this.padding.top-this.padding.bottom};this.x=d3.scale.linear().domain([this.options.xmin,this.options.xmax]).range([0,this.size.width]);this.downx=Math.NaN;this.y=d3.scale.linear().domain([this.options.ymax,this.options.ymin]).nice().range([0,this.size.height]).nice();this.downy=Math.NaN;this.dragged=this.selected=null;this.make_line=function(f){var e=d3.svg.line().defined(function(h,g){if(!isNumeric(h.y)){return false}if(g>0){if(Math.abs(a.points[f][g-1].y-h.y)>g_asymptote_limit){return false}}return true}).x(function(h,g){return a.x(a.points[f][g].x)}).y(function(h,g){return a.y(a.points[f][g].y)});return e};for(var d=0;d<this.num_funcs;d++){this.lines[d]=this.make_line(d)}a.get_data();this.vis=d3.select(this.chart).append("svg").attr("width",this.cx).attr("height",this.cy).append("g").attr("transform","translate("+this.padding.left+","+this.padding.top+")");this.plot=this.vis.append("rect").attr("width",this.size.width).attr("height",this.size.height).style("fill","#FFFFFF").attr("pointer-events","all").on("mousedown.drag",a.plot_drag()).on("touchstart.drag",a.plot_drag());this.plot.call(d3.behavior.zoom().x(this.x).y(this.y).on("zoom",this.redraw()));for(var d=0;d<this.num_funcs;d++){this.vis.append("svg").attr("top",0).attr("left",0).attr("width",this.size.width).attr("height",this.size.height).attr("viewBox","0 0 "+this.size.width+" "+this.size.height).attr("class","graph_line_"+d).append("path").attr("class","line").attr("id","line"+d).attr("d",this.lines[d](this.points[d]))}if(this.options.title){this.vis.append("text").attr("class","axis").text(this.options.title).attr("x",this.size.width/2).attr("dy","-0.8em").style("text-anchor","middle")}if(this.options.xlabel){this.vis.append("text").attr("class","axis").text(this.options.xlabel).attr("x",this.size.width/2).attr("y",this.size.height).attr("dy","2.4em").style("text-anchor","middle")}if(this.options.ylabel){this.vis.append("g").append("text").attr("class","axis").text(this.options.ylabel).style("text-anchor","middle").attr("transform","translate(-25, "+this.size.height/2+") rotate(-90)")}d3.select(this.chart).on("mousemove.drag",a.mousemove()).on("touchmove.drag",a.mousemove()).on("mouseup.drag",a.mouseup()).on("touchend.drag",a.mouseup());this.redraw()()};SimpleGraph.prototype.plot_drag=function(){var a=this;return function(){registerKeyboardHandler(a.keydown());d3.select("body").style("cursor","move");if(d3.event.altKey){var c=d3.mouse(a.vis.node());var b={};b.x=a.x.invert(Math.max(0,Math.min(a.size.width,c[0])));b.y=a.y.invert(Math.max(0,Math.min(a.size.height,c[1])));a.points.push(b);a.points.sort(function(e,d){if(e.x<d.x){return -1}if(e.x>d.x){return 1}return 0});a.selected=b;a.update();d3.event.preventDefault();d3.event.stopPropagation()}}};SimpleGraph.prototype.update=function(){for(var a=0;a<this.num_funcs;a++){this.vis.select("path#line"+a).attr("d",this.lines[a](this.points[a]))}if(d3.event&&d3.event.keyCode){d3.event.preventDefault();d3.event.stopPropagation()}};SimpleGraph.prototype.datapoint_drag=function(){var a=this;return function(b){registerKeyboardHandler(a.keydown());document.onselectstart=function(){return false};a.selected=a.dragged=b;a.update()}};SimpleGraph.prototype.mousemove=function(){var a=this;return function(){var c=d3.mouse(a.vis[0][0]),m=d3.event.changedTouches;if(a.dragged){a.dragged.y=a.y.invert(Math.max(0,Math.min(a.size.height,c[1])));a.update()}if(!isNaN(a.downx)){d3.select("body").style("cursor","ew-resize");var g=a.x.invert(c[0]),k=a.x.domain()[0],j=a.x.domain()[1],l=j-k;if(g!=0){var h,f;h=a.downx/g;f=[k,k+(l*h)];a.x.domain(f);a.redraw()()}d3.event.preventDefault();d3.event.stopPropagation()}if(!isNaN(a.downy)){d3.select("body").style("cursor","ns-resize");var d=a.y.invert(c[1]),b=a.y.domain()[1],n=a.y.domain()[0],i=n-b;if(d!=0){var e,f;e=a.downy/d;f=[b+(i*e),b];a.y.domain(f);a.redraw()()}d3.event.preventDefault();d3.event.stopPropagation()}}};SimpleGraph.prototype.mouseup=function(){var a=this;return function(){document.onselectstart=function(){return true};d3.select("body").style("cursor","auto");d3.select("body").style("cursor","auto");if(!isNaN(a.downx)){a.redraw()();a.downx=Math.NaN;d3.event.preventDefault();d3.event.stopPropagation()}if(!isNaN(a.downy)){a.redraw()();a.downy=Math.NaN;d3.event.preventDefault();d3.event.stopPropagation()}if(a.dragged){a.dragged=null}}};SimpleGraph.prototype.keydown=function(){var a=this;return function(){if(!a.selected){return}switch(d3.event.keyCode){case 8:case 46:var b=a.points.indexOf(a.selected);a.points.splice(b,1);a.selected=a.points.length?a.points[b>0?b-1:0]:null;a.update();break}}};SimpleGraph.prototype.get_data=function(){var b=this;var a=(b.x.domain()[1]-b.x.domain()[0])*g_resolution;var c=b.options.funcs.length;for(var d=0;d<this.num_funcs;d++){this.points[d]=d3.range(a).map(function(e){var g=e/g_resolution+b.x.domain()[0];var f=f_of_x(b.options.funcs[d],g);return{x:g,y:f}},b)}};SimpleGraph.prototype.redraw=function(){var a=this;a.get_data();return function(){var f=function(k){return"translate("+a.x(k)+",0)"},e=function(k){return"translate(0,"+a.y(k)+")"},i=function(k){return k?"#ccc":"#666"},d=a.x.tickFormat(10),b=a.y.tickFormat(10);var j=a.vis.selectAll("g.x").data(a.x.ticks(10),String).attr("transform",f);j.select("text").text(d);var c=j.enter().insert("g","a").attr("class","x").attr("transform",f);c.append("line").attr("stroke",i).attr("y1",0).attr("y2",a.size.height);c.append("text").attr("class","axis").attr("y",a.size.height).attr("dy","1em").attr("text-anchor","middle").text(d).style("cursor","ew-resize").on("mouseover",function(k){d3.select(this).style("font-weight","bold")}).on("mouseout",function(k){d3.select(this).style("font-weight","normal")}).on("mousedown.drag",a.xaxis_drag()).on("touchstart.drag",a.xaxis_drag());j.exit().remove();var h=a.vis.selectAll("g.y").data(a.y.ticks(10),String).attr("transform",e);h.select("text").text(b);var g=h.enter().insert("g","a").attr("class","y").attr("transform",e).attr("background-fill","#FFEEB6");g.append("line").attr("stroke",i).attr("x1",0).attr("x2",a.size.width);g.append("text").attr("class","axis").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").text(b).style("cursor","ns-resize").on("mouseover",function(k){d3.select(this).style("font-weight","bold")}).on("mouseout",function(k){d3.select(this).style("font-weight","normal")}).on("mousedown.drag",a.yaxis_drag()).on("touchstart.drag",a.yaxis_drag());h.exit().remove();a.zoom=d3.behavior.zoom().x(a.x).y(a.y).on("zoom",a.redraw());a.plot.call(a.zoom);a.update()}};SimpleGraph.prototype.xaxis_drag=function(){var a=this;return function(c){document.onselectstart=function(){return false};var b=d3.mouse(a.vis[0][0]);a.downx=a.x.invert(b[0])}};SimpleGraph.prototype.yaxis_drag=function(b){var a=this;return function(e){document.onselectstart=function(){return false};var c=d3.mouse(a.vis[0][0]);a.downy=a.y.invert(c[1])}};